(()=>{"use strict";function e(e){e.classList.add("popup_is-opened"),e.querySelector(".popup__close").addEventListener("click",o),e.addEventListener("click",c),document.addEventListener("keydown",n)}function t(e){e.classList.remove("popup_is-opened"),e.removeEventListener("click",o),document.removeEventListener("keydown",n)}function n(e){"Escape"===e.key&&t(document.querySelector(".popup_is-opened"))}function o(e){t(e.target.closest(".popup"))}function c(e){e.target===e.currentTarget&&t(e.currentTarget)}function r(t,n){var o=document.querySelector(".popup__image"),c=document.querySelector(".popup_type_image"),r=document.querySelector(".popup__caption");o.src=t,o.alt=n,r.textContent=n,e(c)}function a(e,t){t?(e.textContent="Сохранение",e.classList.add("loading")):(e.classList.remove("loading"),e.textContent="Сохранить")}var u="https://mesto.nomoreparties.co/v1/cohort-mag-4",i={authorization:"93c90859-501a-40fa-a2ac-1175f2406f19","Content-Type":"application/json"};function l(e){return e.ok?e.json():Promise.reject(e.status)}var s=document.querySelector("#card-template").content;function d(e,t,n){var o=s.cloneNode(!0).querySelector(".card"),c=o.querySelector(".card__image"),r=o.querySelector(".card__title"),a=o.querySelector(".card__delete-button"),d=o.querySelector(".card__like-button");return c.src=e.link,c.alt=e.name,r.textContent=e.name,o.dataset.cardId=e._id,d.dataset.like=e.likes.length,function(e,t,n){t===n&&e.classList.remove("hide")}(a,e.owner._id,n),f(d,e,n),d.addEventListener("click",(function(){return function(e,t,n){var o,c,r=p(t,n);(o=t._id,c=r?"DELETE":"PUT",fetch("".concat(u,"/cards/").concat(o,"/likes"),{method:c,headers:i}).then((function(e){return l(e)}))).then((function(o){t.likes=o.likes,f(e,t,n),e.dataset.like=t.likes.length})).catch((function(e){console.log("Ошибка при установке like: ".concat(e))}))}(d,e,n)})),c.addEventListener("click",(function(){return t(c.src,r.textContent)})),o}function p(e,t){return e.likes.some((function(e){return e._id===t}))}function f(e,t,n){p(t,n)?e.classList.add("card__like-button_is-active"):e.classList.remove("card__like-button_is-active")}document.querySelector(".popup__form").querySelector(".popup__input");var m=function(e){var t=Array.from(e.querySelectorAll(".popup__input")),n=e.querySelector(".popup__button");t.forEach((function(t){_(e,t),t.setCustomValidity("")})),v(t,n)},_=function(e,t){var n=e.querySelector(".".concat(t.name,"-error"));n?(n.classList.remove("popup__form-error"),n.textContent=""):console.warn("Элемент для отображения ошибки с селектором .".concat(t.name,"-error не найден"))},v=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove("popup__button_disabled")):(t.disabled=!0,t.classList.add("popup__button_disabled"))};function y(e,t,n){t.textContent=e.name,n.textContent=e.about}function h(e,t){t.style.backgroundImage="url(".concat(e,")")}var S=document.querySelector(".places__list"),q=document.querySelector('form[name="new-place"]'),L=document.querySelector('form[name="change-avatar"]'),g=document.querySelector(".profile__add-button"),k=document.querySelectorAll(".popup__close"),E=document.querySelector(".popup_type_new-card"),b=document.querySelector(".popup_type_edit"),C=document.querySelector(".profile__edit-button"),x=document.forms["edit-profile"],A=x.elements.name,T=x.elements.description,w=document.querySelector(".profile__title"),I=document.querySelector(".profile__description"),D=document.querySelector(".profile__image"),O=document.querySelector(".popup_change-avatar"),P=localStorage.getItem("userId");x.addEventListener("submit",(function(e){var n,o=b.querySelector(".popup__button");a(o,!0),e.preventDefault(),(n={name:A.value,about:T.value},fetch("".concat(u,"/users/me"),{method:"PATCH",headers:i,body:JSON.stringify(n)}).then((function(e){return l(e)}))).then((function(e){y(e,w,I),t(b)})).catch((function(e){console.log("Ьмиси: ".concat(e))})).finally((function(){a(o,!1)}))})),g.addEventListener("click",(function(){e(E);var t=E.querySelector(".popup__form");m(t)})),q.addEventListener("submit",(function(e){var n=q.querySelector(".popup__button");a(n,!0),e.preventDefault();var o,c=q.elements["place-name"].value,s=q.elements.link.value;c&&s&&(o={name:c,link:s},fetch("".concat(u,"/cards"),{method:"POST",headers:i,body:JSON.stringify(o)}).then((function(e){return l(e)}))).then((function(e){var n=d(e,r,P);S.prepend(n),q.reset(),t(E)})).catch((function(e){console.log("Ошибка при добавлении карточки: ".concat(e))})).finally((function(){a(n,!1)}))})),C.addEventListener("click",(function(){e(b),A.value=w.textContent,T.value=I.textContent,m(x)})),D.addEventListener("click",(function(){var n=L.querySelector(".popup__input_type_url");e(O);var o=O.querySelector(".popup__button");n.value="",m(x),o.addEventListener("click",(function(){var e;a(o,!0),(e={avatar:n.value},fetch("".concat(u,"/users/me/avatar"),{method:"PATCH",headers:i,body:JSON.stringify(e)}).then((function(e){return l(e)}))).then((function(){h(n.value,D),t(O)})).catch((function(e){console.log("Ошибка при смене аватара: ".concat(e))})).finally((function(){a(o,!1)}))}))})),k.forEach((function(e){e.addEventListener("click",(function(){t(e.closest(".popup"))}))})),document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll(".popup").forEach((function(e){e.classList.add("popup_is-animated")}))})),fetch("".concat(u,"/users/me"),{headers:i}).then((function(e){return l(e)})).then((function(e){y(e,w,I),h(e.avatar,D),localStorage.setItem("userId",e._id)})).catch((function(e){console.error("Ошибка профиля:",e)})),fetch("".concat(u,"/cards"),{headers:i}).then((function(e){return l(e)})).then((function(e){!function(e){e.forEach((function(e){var t=d(e,r,P);S.appendChild(t)}))}(e)})).catch((function(e){console.error("Ошибка при загрузке карточек:",e)})),Array.from(document.querySelectorAll(".popup__form")).forEach((function(e){!function(e){var t=Array.from(e.querySelectorAll(".popup__input")),n=e.querySelector(".popup__button");v(t,n),t.forEach((function(o){o.addEventListener("input",(function(){(function(e,t){var n="";t.required&&!t.value?n=t.validationMessage:"text"!==t.type||function(e){return"text"!==e.type||/^[a-zA-Zа-яА-Я\s-]+$/.test(e.value)}(t)||(n=t.dataset.message||"Разрешены только латинские и кириллические буквы, знаки дефиса и пробелы."),n?t.setCustomValidity(n):t.setCustomValidity(""),t.validity.valid?_(e,t):function(e,t,n){var o=e.querySelector(".".concat(t.name,"-error"));o?(o.textContent=n,o.classList.add("popup__form-error")):console.warn("Элемент для отображения ошибки с селектором .".concat(t.name,"-error не найден"))}(e,t,t.validationMessage)})(e,o),v(t,n)}))}))}(e)})),S.addEventListener("click",(function(n){if(n.target.classList.contains("card__delete-button")){var o=n.target.closest(".card"),c=o.dataset.cardId;r=function(){(function(e){return fetch("".concat(u,"/cards/").concat(e),{method:"DELETE",headers:i}).then((function(e){return l(e)}))})(c).then((function(){!function(e){e.remove()}(o)})).catch((function(e){console.log("Ошибка при удалении карточки: ".concat(e))}))},e(a=document.querySelector(".popup_confirmation")),a.querySelector(".button__confirmation").addEventListener("click",(function(){r(),t(a)}))}var r,a}))})();